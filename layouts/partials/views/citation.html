{{ $item := .item }}
{{ $has_attachments := partial "functions/has_attachments" $item }}

<div class="pub-list-item view-citation" style="margin-bottom: 1rem">
  <i class="far fa-file-alt pub-icon" aria-hidden="true"></i>

  {{/* APA Style */}}
  {{ if eq (site.Params.hugoblox.content.citations.style | default "apa") "apa" }}

  <span class="article-metadata li-cite-author">
    {{ partial "page_metadata_authors" $item }}
  </span>
  ({{- $item.Date.Format "2006" -}}).
  <a href="{{ $item.RelPermalink }}" class="underline">{{ $item.Title }}</a>.
  {{ if $item.Params.publication_short }}
    {{- $item.Params.publication_short | markdownify -}}.
  {{ else if $item.Params.publication }}
    {{- $item.Params.publication | markdownify -}}.
  {{ end }}

  {{ if $has_attachments }}
  <div class="flex flex-wrap space-x-3">
    {{ partial "page_links" (dict "page" $item "is_list" 1) }}
  </div>
  {{ end }}

  {{/* IEEE Style */}}
  {{ else }}

  {{/* Custom IEEE author formatting */}}
  <span class="article-metadata li-cite-author" style="text-transform: none; font-variant: normal;">
    {{- $authors := $item.Params.authors -}}
    {{- if $authors -}}
      {{- $len := len $authors -}}
      {{- range $index, $author := $authors -}}
        {{- if gt $index 0 -}}, {{ end -}}
        {{- if eq (add $index 1) $len -}}and {{ end -}}
        {{- /* Convert "Last, F." to "F. Last" */ -}}
        {{- if in $author "," -}}
          {{- $parts := split $author ", " -}}
          {{- if eq (len $parts) 2 -}}
            {{- $lastName := index $parts 0 -}}
            {{- $initial := index $parts 1 -}}
            {{- /* Fix Bar lev */ -}}
            {{- $lastName = replace $lastName "Bar lev" "Bar-Lev" -}}
            {{- printf "%s. %s" (trim $initial ".") $lastName -}}
          {{- else -}}
            {{- $author -}}
          {{- end -}}
        {{- else -}}
          {{- $author -}}
        {{- end -}}
      {{- end -}}.
    {{- end -}}
  </span>
  <a href="{{ $item.RelPermalink }}">"{{ $item.Title }},"</a>
  {{ if $item.Params.publication_short }}
    <em>{{- $item.Params.publication_short | markdownify -}}</em>,
  {{ else if $item.Params.publication }}
    <em>{{- $item.Params.publication | markdownify -}}</em>,
  {{ end }}
  {{- $item.Date.Format "2006" -}}.

  {{ if $has_attachments }}
  <div class="flex flex-wrap space-x-3">
    {{ partial "page_links" (dict "page" $item "is_list" 1) }}
  </div>
  {{ end }}

  {{ end }}
</div>
